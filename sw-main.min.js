document.addEventListener("DOMContentLoaded",function(){for(var e=document.querySelectorAll(".sw"),d=0;d<e.length;++d)new SpinningWheel(e[d])});function SpinningWheel(e){this.items=[];this.velocityPeak=this.velocity=this.rotation=0;this.minVelocity=10;this.maxVelocity=12;this.acceleration=.6;this.friction=.07;this.isSpinning=this.isAccelerating=!1;this.soundOn=!0;this.result=null;var d=e.querySelector(".sw__wheel");this.c=d.getContext("2d");this.H=this.W=588;this.scale=2;d.width=this.W*this.scale;d.height=this.H*this.scale;this.c.scale(this.scale,this.scale);var r=window.location.href;d=e.id;var g=d.substr(d.length-1,1),t=e.querySelector(".sw__wheel-wrapper");d=e.querySelector(".sw__spin-btn");var z=e.querySelector(".sw__result"),f=t.querySelector(".sw__popover"),n=f.querySelectorAll(".sw__btn");t=n[0];n=n[1];var l=e.querySelector(".sw__form"),h=l.querySelectorAll(".sw__btn");e=h[0];var A=h[1],u=h[2],v=h[3];h=h[4];l=l.querySelector(".sw__popover");var p=document.getElementById("share-wheel"+g),w=document.getElementsByName("share-custom"+g)[0],B=document.querySelector("a[href='#copy"+g+"']"),x=document.getElementById("facebook-share"+g),y=document.getElementById("twitter-share"+g),m=document.getElementById("wheel-spaces"+g);this.closeAllPopovers=function(a){for(var b=document.querySelectorAll(".sw__popover"),c=0;c<b.length;++c)this.setPopoverState(b[c],!1,a)};this.closePopover=function(a,b){this.setPopoverState(a,!1);!0===b&&(this.items.splice(this.result,1),this.draw(),this.updateWheelSpaces())};this.setPopoverState=function(a,b,c){var k=a.classList;if(!0===b&&"true"==a.getAttribute("data-can-open"))k.contains("sw__popover--hide")&&k.remove("sw__popover--hide");else if(!1===b&&!k.contains("sw__popover--hide"))if(c)if(b=c.target,27===c.keyCode)k.add("sw__popover--hide");else{if(!c.keyCode){do{if(b===a)return;b=b.parentNode}while(b);k.add("sw__popover--hide")}}else k.add("sw__popover--hide")};this.toggleCanOpenState=function(a){var b=a.classList.contains("sw__popover--hide");a.setAttribute("data-can-open",b)};this.spin=function(){!this.isSpinning&&0<this.items.length&&(this.isAccelerating=this.isSpinning=m.disabled=!0,this.velocityPeak=Math.round(Math.random()*(this.maxVelocity-this.minVelocity))+this.minVelocity,this.incRotation())};this.incRotation=function(){if(this.isSpinning){this.rotation+=this.velocity;360<=this.rotation&&(this.rotation=0);this.isAccelerating?(this.velocity+=this.acceleration,this.velocity>=this.velocityPeak&&(this.isAccelerating=!1)):this.velocity-=this.friction;var a=this.rotation%(360/this.items.length);0<=a&&a<=this.velocity&&this.soundOn&&this.sound.click.play();0>=this.velocity&&!this.isAccelerating&&(m.disabled=!1,this.velocity=0,this.isSpinning=!1,this.result=Math.floor((360-this.rotation)/(360/this.items.length)),z.innerHTML=this.items[this.result]||"(blank)",this.setPopoverState(f,!0),this.soundOn&&this.sound.tada.play());this.draw();requestAnimationFrame(this.incRotation.bind(this))}};this.rearrangeItems=function(a){if(!this.isSpinning){var b=this.getWheelSpacesLines();a&&"shuffle"!=a?"sort"==a&&b.sort(function(a,b){return a<b?-1:a>b?1:0}):b.sort(function(){return.5>Math.random()?-1:1});this.items=b;this.draw();this.updateWheelSpaces()}};this.copyURL=function(a,b){b&&b.preventDefault();try{a.select(),document.execCommand("copy"),a.blur()}catch(c){console.log("Failed to copy")}};this.updateCustomURL=function(a){var b=this.getWheelSpacesLines(),c=a;-1<a.indexOf("spaces=")&&(c=a.substr(0,a.indexOf("spaces=")-1));w.checked&&(a=-1<c.indexOf("?")&&-1<c.indexOf("&")?"&":"?",b.forEach(function(a,c){b[c]=encodeURIComponent(a)}),c+=a+"spaces="+b);p.value=c;x.href=this.updateSocialShareURL(x.href,"u",p.value);y.href=this.updateSocialShareURL(y.href,"url",p.value)};this.updateSocialShareURL=function(a,b,c){b+="=";var d=a.indexOf(b);-1<d?a=a.substr(0,d+b.length)+c:(c=b+c,a=-1<a.indexOf("?")?a+("&"+c):a+("?"+c));return a};this.toggleSound=function(a,b){this.soundOn=!this.soundOn;a instanceof HTMLElement&&b instanceof HTMLElement&&(a.classList.add("sw__btn--inactive"),b.classList.remove("sw__btn--inactive"),b.focus())};this.updateItems=function(){this.isSpinning||(this.items=this.getWheelSpacesLines(),this.draw(),this.updateCustomURL(r))};this.updateWheelSpaces=function(){m.value=this.items.join("\n")};this.getWheelSpacesLines=function(){return m.value.split("\n")};this.draw=function(){var a=this.c,b=this.W/2,c=this.H/2,d=this.W/4,e=2*d,g=["#f7931e","#124a76","#0c6642","#54a0e8"],h=360/this.items.length*Math.PI/180,l=(this.rotation-90)*Math.PI/180;a.clearRect(0,0,this.W,this.H);a.lineWidth=this.W/2;this.items.forEach(function(e,f){var m=l+h*f,k=l+h*(f+1);a.strokeStyle=g[f%g.length];a.beginPath();a.arc(b,c,d,m,k);a.stroke();a.closePath()});a.fillStyle="#e6e6e6";a.textBaseline="middle";a.strokeStyle="#e6e6e6";a.lineWidth=4;var m=this.items.length;this.items.forEach(function(d,g){var f=l+h*g,k=Math.PI+f+h/2,q=d.toUpperCase(),n=32,p=0;1<m&&(a.beginPath(),a.moveTo(b,c),a.lineTo(b+Math.cos(f)*e,c+Math.sin(f)*e),a.stroke(),a.closePath());a.font=n+"px sans-serif";12<q.length&&(q=q.substr(0,12)+"\u2026");p+=a.measureText(q).width;a.save();a.setTransform(this.scale,0,0,this.scale,0,0);a.translate(b-Math.cos(k)*(e-40),c-Math.sin(k)*(e-40));for(a.rotate(k);120<p;)n-=.1,a.font=n+"px sans-serif",p=a.measureText(q).width;a.fillText(q,0,0);a.restore()});var f=a.createLinearGradient(0,0,0,e);f.addColorStop(0,"rgba(255,255,255,0.5)");f.addColorStop(1,"rgba(0,0,0,0.2)");a.strokeStyle=f;a.lineWidth=12;a.beginPath();a.arc(e,b,c,0,2*Math.PI);a.stroke();a.closePath()};this.sound={click:document.getElementById("sw-click"),tada:document.getElementById("sw-tada")};this.items=this.getWheelSpacesLines();this.draw();this.updateCustomURL(r);g="ontouchstart"in document.documentElement?"touchstart":"mousedown";document.addEventListener(g,this.closeAllPopovers.bind(this));document.addEventListener("keydown",this.closeAllPopovers.bind(this));d.addEventListener("click",this.spin.bind(this));t.addEventListener("click",this.closePopover.bind(this,f));n.addEventListener("click",this.closePopover.bind(this,f,!0));e.addEventListener("click",this.rearrangeItems.bind(this,"shuffle"));A.addEventListener("click",this.rearrangeItems.bind(this,"sort"));u.addEventListener("click",this.setPopoverState.bind(null,l,!0));u.addEventListener(g,this.toggleCanOpenState.bind(null,l));u.addEventListener("keydown",this.toggleCanOpenState.bind(null,l));B.addEventListener("click",this.copyURL.bind(null,p));w.addEventListener("change",this.updateCustomURL.bind(this,r));v.addEventListener("click",this.toggleSound.bind(this,v,h));h.addEventListener("click",this.toggleSound.bind(this,h,v));m.addEventListener("oninput"in document.documentElement?"input":"change",this.updateItems.bind(this))};